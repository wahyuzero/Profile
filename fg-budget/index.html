<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frugal Budget Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .dark .gradient-bg {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .dark {
            color-scheme: dark;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600 dark:text-gray-400">Loading...</p>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 w-full max-w-md mx-4 animate-slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 id="authTitle" class="text-2xl font-bold text-gray-800 dark:text-white">Masuk</h2>
                <button id="closeAuth" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="authForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                    <input type="email" id="email" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Password</label>
                    <input type="password" id="password" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                </div>
                
                <button type="submit" id="authSubmit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium">
                    Masuk
                </button>
            </form>
            
            <div class="mt-4 text-center">
                <p class="text-gray-600 dark:text-gray-400">
                    <span id="authSwitchText">Belum punya akun?</span>
                    <button id="authSwitch" class="text-blue-600 hover:text-blue-700 font-medium ml-1">Daftar</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="min-h-screen hidden">
        <!-- Header -->
        <header class="gradient-bg shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-wallet text-white text-2xl"></i>
                        <h1 class="text-2xl font-bold text-white">Frugal Budget</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button id="darkToggle" class="text-white hover:text-gray-200 transition-colors">
                            <i class="fas fa-moon text-xl"></i>
                        </button>
                        
                        <div class="relative">
                            <button id="userMenu" class="flex items-center space-x-2 text-white hover:text-gray-200 transition-colors">
                                <i class="fas fa-user-circle text-xl"></i>
                                <span id="userName">User</span>
                                <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            
                            <div id="userDropdown" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg py-2 hidden">
                                <button id="logout" class="block w-full text-left px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Keluar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white dark:bg-gray-800 shadow-sm border-b dark:border-gray-700">
            <div class="container mx-auto px-4">
                <div class="flex space-x-8">
                    <button class="nav-btn active py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium" data-tab="dashboard">
                        <i class="fas fa-chart-line mr-2"></i>Dashboard
                    </button>
                    <button class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 font-medium" data-tab="transactions">
                        <i class="fas fa-list mr-2"></i>Transaksi
                    </button>
                    <button class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 font-medium" data-tab="reports">
                        <i class="fas fa-chart-pie mr-2"></i>Laporan
                    </button>
                    <button class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 font-medium" data-tab="budget">
                        <i class="fas fa-piggy-bank mr-2"></i>Budget
                    </button>
                </div>
            </div>
        </nav>

        <!-- Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <!-- Balance Card -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg card-hover animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 dark:text-gray-400 text-sm mb-1">Saldo</p>
                                <p id="balance" class="text-2xl font-bold text-gray-800 dark:text-white">Rp 0</p>
                            </div>
                            <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded-full">
                                <i class="fas fa-wallet text-blue-600 dark:text-blue-400 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Income Card -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg card-hover animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 dark:text-gray-400 text-sm mb-1">Pemasukan</p>
                                <p id="totalIncome" class="text-2xl font-bold text-green-600">Rp 0</p>
                            </div>
                            <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                <i class="fas fa-arrow-up text-green-600 dark:text-green-400 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expense Card -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg card-hover animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 dark:text-gray-400 text-sm mb-1">Pengeluaran</p>
                                <p id="totalExpense" class="text-2xl font-bold text-red-600">Rp 0</p>
                            </div>
                            <div class="bg-red-100 dark:bg-red-900 p-3 rounded-full">
                                <i class="fas fa-arrow-down text-red-600 dark:text-red-400 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Add Transaction -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg mb-8 animate-fade-in">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-plus-circle mr-2 text-blue-600"></i>Tambah Transaksi Cepat
                    </h3>
                    
                    <form id="quickAddForm" class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <select id="quickType" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                            <option value="pengeluaran">Pengeluaran</option>
                            <option value="pemasukan">Pemasukan</option>
                        </select>
                        
                        <select id="quickCategory" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                            <option value="Makan">Makan</option>
                            <option value="Transport">Transport</option>
                            <option value="Hiburan">Hiburan</option>
                        </select>
                        
                        <input type="number" id="quickAmount" placeholder="Nominal" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white" required>
                        
                        <input type="text" id="quickDescription" placeholder="Deskripsi" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white" required>
                        
                        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Tambah
                        </button>
                    </form>
                </div>

                <!-- Recent Transactions -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg animate-fade-in">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-history mr-2 text-blue-600"></i>Transaksi Terbaru
                    </h3>
                    <div id="recentTransactions"></div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                            <i class="fas fa-list mr-2 text-blue-600"></i>Semua Transaksi
                        </h3>
                        <button id="addTransactionBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Tambah Transaksi
                        </button>
                    </div>
                    
                    <!-- Filters -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <input type="text" id="searchTransaction" placeholder="Cari transaksi..." class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                        
                        <select id="filterType" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                            <option value="">Semua Tipe</option>
                            <option value="pemasukan">Pemasukan</option>
                            <option value="pengeluaran">Pengeluaran</option>
                        </select>
                        
                        <select id="filterCategory" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                            <option value="">Semua Kategori</option>
                        </select>
                        
                        <input type="date" id="filterDate" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    </div>
                    
                    <!-- Transactions List -->
                    <div id="transactionsList"></div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Pie Chart -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-chart-pie mr-2 text-blue-600"></i>Pengeluaran per Kategori
                        </h3>
                        <canvas id="expenseChart" width="400" height="300"></canvas>
                    </div>
                    
                    <!-- Line Chart -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-chart-line mr-2 text-blue-600"></i>Tren Saldo
                        </h3>
                        <canvas id="balanceChart" width="400" height="300"></canvas>
                    </div>
                </div>
                
                <!-- Period Reports -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg mt-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-calendar mr-2 text-blue-600"></i>Laporan Periode
                    </h3>
                    
                    <div class="flex space-x-4 mb-6">
                        <button class="period-btn bg-blue-600 text-white px-4 py-2 rounded-lg" data-period="daily">Harian</button>
                        <button class="period-btn bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg" data-period="weekly">Mingguan</button>
                        <button class="period-btn bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg" data-period="monthly">Bulanan</button>
                        <button class="period-btn bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg" data-period="yearly">Tahunan</button>
                    </div>
                    
                    <div id="periodReport"></div>
                </div>
            </div>

            <!-- Budget Tab -->
            <div id="budget" class="tab-content hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                            <i class="fas fa-piggy-bank mr-2 text-blue-600"></i>Budget Tracker
                        </h3>
                        <button id="addBudgetBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Tambah Budget
                        </button>
                    </div>
                    
                    <div id="budgetList"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 w-full max-w-md mx-4 animate-slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 id="transactionModalTitle" class="text-2xl font-bold text-gray-800 dark:text-white">Tambah Transaksi</h2>
                <button id="closeTransactionModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="transactionForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipe</label>
                    <select id="transactionType" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                        <option value="pengeluaran">Pengeluaran</option>
                        <option value="pemasukan">Pemasukan</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Kategori</label>
                    <select id="transactionCategory" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nominal</label>
                    <input type="number" id="transactionAmount" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Deskripsi</label>
                    <input type="text" id="transactionDescription" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tanggal</label>
                    <input type="date" id="transactionDate" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium">
                    Simpan Transaksi
                </button>
            </form>
        </div>
    </div>

    <!-- Budget Modal -->
    <div id="budgetModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 w-full max-w-md mx-4 animate-slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Tambah Budget</h2>
                <button id="closeBudgetModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="budgetForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Kategori</label>
                    <select id="budgetCategory" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    </select>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Budget</label>
                    <input type="number" id="budgetAmount" required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium">
                    Simpan Budget
                </button>
            </form>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            API_KEY: '$2a$10$LGR4QrcwHCWXpH1G17WXMu7wD5kVwdLBMO1H1QH54y/TIbcn0eeoy',
            BIN_ID: '68326df88960c979a5a0c225',
            API_URL: 'https://api.jsonbin.io/v3'
        };

        // Global State
        let currentUser = null;
        let allData = { users: [] };
        let isLogin = true;
        let editingTransaction = null;

        // Categories
        const INCOME_CATEGORIES = ['Gaji', 'Bonus', 'Investasi', 'Bisnis', 'Lainnya'];
        const EXPENSE_CATEGORIES = ['Makan', 'Transport', 'Hiburan', 'Topup/Paket Data', 'Belanja', 'Kesehatan', 'Lainnya'];

        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 animate-slide-up ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // API Functions
        async function loadData() {
            try {
                const response = await fetch(`${CONFIG.API_URL}/b/${CONFIG.BIN_ID}/latest`, {
                    headers: {
                        'X-Access-Key': CONFIG.API_KEY
                    }
                });
                const data = await response.json();
                allData = data.record || { users: [] };
            } catch (error) {
                console.error('Error loading data:', error);
                allData = { users: [] };
            }
        }

        async function saveData() {
            try {
                const response = await fetch(`${CONFIG.API_URL}/b/${CONFIG.BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Access-Key': CONFIG.API_KEY
                    },
                    body: JSON.stringify(allData)
                });
                
                if (response.ok) {
                    showToast('Data berhasil disimpan');
                } else {
                    throw new Error('Failed to save data');
                }
            } catch (error) {
                console.error('Error saving data:', error);
                showToast('Gagal menyimpan data', 'error');
            }
        }

        // Auth Functions
        function hashPassword(password) {
            return btoa(password); // Simple base64 encoding
        }

        function register(email, password) {
            const existingUser = allData.users.find(user => user.email === email);
            if (existingUser) {
                showToast('Email sudah terdaftar', 'error');
                return false;
            }

            const newUser = {
                uid: generateId(),
                email: email,
                password: hashPassword(password),
                settings: {
                    darkMode: false,
                    budget: {}
                },
                categories: {
                    income: [...INCOME_CATEGORIES],
                    expense: [...EXPENSE_CATEGORIES]
                },
                transactions: []
            };

            allData.users.push(newUser);
            saveData();
            showToast('Registrasi berhasil');
            return true;
        }

        function login(email, password) {
            const user = allData.users.find(user => 
                user.email === email && user.password === hashPassword(password)
            );
            
            if (user) {
                currentUser = user;
                localStorage.setItem('userToken', user.uid);
                localStorage.setItem('userEmail', user.email);
                showApp();
                showToast('Login berhasil');
                return true;
            } else {
                showToast('Email atau password salah', 'error');
                return false;
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('userToken');
            localStorage.removeItem('userEmail');
            showAuth();
        }

        function autoLogin() {
            const token = localStorage.getItem('userToken');
            const email = localStorage.getItem('userEmail');
            
            if (token && email) {
                const user = allData.users.find(user => user.uid === token && user.email === email);
                if (user) {
                    currentUser = user;
                    showApp();
                    return true;
                }
            }
            return false;
        }

        // UI Functions
        function showAuth() {
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
        }

        function hideAuth() {
            document.getElementById('authModal').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('app').classList.remove('hidden');
            hideAuth();
            updateUserInfo();
            loadDashboard();
            applyDarkMode();
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.email.split('@')[0];
            }
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.remove('hidden');
            
            // Add active class to clicked nav button
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            activeBtn.classList.add('active', 'border-blue-500', 'text-blue-600');
            activeBtn.classList.remove('border-transparent', 'text-gray-500');
            
            // Load content based on tab
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
                case 'reports':
                    loadReports();
                    break;
                case 'budget':
                    loadBudget();
                    break;
            }
        }

        // Dashboard Functions
        function loadDashboard() {
            if (!currentUser) return;
            
            const transactions = currentUser.transactions || [];
            const income = transactions.filter(t => t.tipe === 'pemasukan').reduce((sum, t) => sum + t.nominal, 0);
            const expense = transactions.filter(t => t.tipe === 'pengeluaran').reduce((sum, t) => sum + t.nominal, 0);
            const balance = income - expense;
            
            document.getElementById('balance').textContent = formatCurrency(balance);
            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpense').textContent = formatCurrency(expense);
            
            loadRecentTransactions();
            updateQuickAddCategories();
        }

        function loadRecentTransactions() {
            const container = document.getElementById('recentTransactions');
            const transactions = currentUser.transactions.slice(-5).reverse();
            
            if (transactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">Belum ada transaksi</p>';
                return;
            }
            
            container.innerHTML = transactions.map(t => `
                <div class="flex items-center justify-between p-4 border-b dark:border-gray-700 last:border-b-0">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 rounded-full ${t.tipe === 'pemasukan' ? 'bg-green-100 dark:bg-green-900' : 'bg-red-100 dark:bg-red-900'}">
                            <i class="fas ${t.tipe === 'pemasukan' ? 'fa-arrow-up text-green-600' : 'fa-arrow-down text-red-600'} dark:text-opacity-80"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800 dark:text-white">${t.deskripsi}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${t.kategori} • ${t.tanggal}</p>
                        </div>
                    </div>
                    <p class="font-semibold ${t.tipe === 'pemasukan' ? 'text-green-600' : 'text-red-600'}">${formatCurrency(t.nominal)}</p>
                </div>
            `).join('');
        }

        function updateQuickAddCategories() {
            const select = document.getElementById('quickCategory');
            const type = document.getElementById('quickType').value;
            const categories = type === 'pemasukan' ? currentUser.categories.income : currentUser.categories.expense;
            
            select.innerHTML = categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }

        // Transaction Functions
        function loadTransactions() {
            if (!currentUser) return;
            
            updateFilterCategories();
            displayTransactions();
        }

        function updateFilterCategories() {
            const select = document.getElementById('filterCategory');
            const allCategories = [...currentUser.categories.income, ...currentUser.categories.expense];
            const uniqueCategories = [...new Set(allCategories)];
            
            select.innerHTML = '<option value="">Semua Kategori</option>' + 
                uniqueCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }

        function displayTransactions() {
            const container = document.getElementById('transactionsList');
            let transactions = [...currentUser.transactions].reverse();
            
            // Apply filters
            const search = document.getElementById('searchTransaction').value.toLowerCase();
            const typeFilter = document.getElementById('filterType').value;
            const categoryFilter = document.getElementById('filterCategory').value;
            const dateFilter = document.getElementById('filterDate').value;
            
            if (search) {
                transactions = transactions.filter(t => 
                    t.deskripsi.toLowerCase().includes(search) || 
                    t.kategori.toLowerCase().includes(search)
                );
            }
            
            if (typeFilter) {
                transactions = transactions.filter(t => t.tipe === typeFilter);
            }
            
            if (categoryFilter) {
                transactions = transactions.filter(t => t.kategori === categoryFilter);
            }
            
            if (dateFilter) {
                transactions = transactions.filter(t => t.tanggal === dateFilter);
            }
            
            if (transactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Tidak ada transaksi yang ditemukan</p>';
                return;
            }
            
            container.innerHTML = transactions.map(t => `
                <div class="flex items-center justify-between p-4 border border-gray-200 dark:border-gray-600 rounded-lg mb-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                    <div class="flex items-center space-x-4">
                        <div class="p-3 rounded-full ${t.tipe === 'pemasukan' ? 'bg-green-100 dark:bg-green-900' : 'bg-red-100 dark:bg-red-900'}">
                            <i class="fas ${t.tipe === 'pemasukan' ? 'fa-arrow-up text-green-600' : 'fa-arrow-down text-red-600'} dark:text-opacity-80"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 dark:text-white">${t.deskripsi}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${t.kategori} • ${t.tanggal}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <p class="font-bold ${t.tipe === 'pemasukan' ? 'text-green-600' : 'text-red-600'}">${formatCurrency(t.nominal)}</p>
                        <div class="flex space-x-2">
                            <button onclick="editTransaction('${t.id}')" class="text-blue-600 hover:text-blue-800 dark:text-blue-400">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTransaction('${t.id}')" class="text-red-600 hover:text-red-800 dark:text-red-400">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addTransaction(tipe, kategori, nominal, deskripsi, tanggal) {
            const transaction = {
                id: generateId(),
                tipe: tipe,
                kategori: kategori,
                nominal: parseInt(nominal),
                deskripsi: deskripsi,
                tanggal: tanggal || new Date().toISOString().split('T')[0]
            };
            
            currentUser.transactions.push(transaction);
            saveData();
            loadDashboard();
            
            if (document.getElementById('transactions').classList.contains('hidden') === false) {
                displayTransactions();
            }
        }

        function editTransaction(id) {
            const transaction = currentUser.transactions.find(t => t.id === id);
            if (!transaction) return;
            
            editingTransaction = transaction;
            
            document.getElementById('transactionModalTitle').textContent = 'Edit Transaksi';
            document.getElementById('transactionType').value = transaction.tipe;
            document.getElementById('transactionAmount').value = transaction.nominal;
            document.getElementById('transactionDescription').value = transaction.deskripsi;
            document.getElementById('transactionDate').value = transaction.tanggal;
            
            updateTransactionCategories();
            document.getElementById('transactionCategory').value = transaction.kategori;
            
            document.getElementById('transactionModal').classList.remove('hidden');
        }

        function deleteTransaction(id) {
            if (confirm('Yakin ingin menghapus transaksi ini?')) {
                currentUser.transactions = currentUser.transactions.filter(t => t.id !== id);
                saveData();
                loadDashboard();
                displayTransactions();
                showToast('Transaksi berhasil dihapus');
            }
        }

        function updateTransactionCategories() {
            const select = document.getElementById('transactionCategory');
            const type = document.getElementById('transactionType').value;
            const categories = type === 'pemasukan' ? currentUser.categories.income : currentUser.categories.expense;
            
            select.innerHTML = categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }

        // Reports Functions
        function loadReports() {
            if (!currentUser) return;
            
            createExpenseChart();
            createBalanceChart();
            loadPeriodReport('daily');
        }

        function createExpenseChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            const expenses = currentUser.transactions.filter(t => t.tipe === 'pengeluaran');
            
            const categoryData = {};
            expenses.forEach(t => {
                categoryData[t.kategori] = (categoryData[t.kategori] || 0) + t.nominal;
            });
            
            const labels = Object.keys(categoryData);
            const data = Object.values(categoryData);
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
            ];
            
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createBalanceChart() {
            const ctx = document.getElementById('balanceChart').getContext('2d');
            const transactions = [...currentUser.transactions].sort((a, b) => new Date(a.tanggal) - new Date(b.tanggal));
            
            let balance = 0;
            const balanceData = [];
            const labels = [];
            
            transactions.forEach(t => {
                balance += t.tipe === 'pemasukan' ? t.nominal : -t.nominal;
                balanceData.push(balance);
                labels.push(t.tanggal);
            });
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Saldo',
                        data: balanceData,
                        borderColor: '#36A2EB',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function loadPeriodReport(period) {
            const container = document.getElementById('periodReport');
            const transactions = currentUser.transactions;
            
            let groupedData = {};
            const now = new Date();
            
            transactions.forEach(t => {
                const date = new Date(t.tanggal);
                let key;
                
                switch(period) {
                    case 'daily':
                        key = t.tanggal;
                        break;
                    case 'weekly':
                        const week = getWeekNumber(date);
                        key = `Minggu ${week}, ${date.getFullYear()}`;
                        break;
                    case 'monthly':
                        key = `${date.toLocaleString('id-ID', { month: 'long' })} ${date.getFullYear()}`;
                        break;
                    case 'yearly':
                        key = date.getFullYear().toString();
                        break;
                }
                
                if (!groupedData[key]) {
                    groupedData[key] = { income: 0, expense: 0, transactions: [] };
                }
                
                groupedData[key].transactions.push(t);
                if (t.tipe === 'pemasukan') {
                    groupedData[key].income += t.nominal;
                } else {
                    groupedData[key].expense += t.nominal;
                }
            });
            
            const sortedKeys = Object.keys(groupedData).sort().reverse();
            
            container.innerHTML = sortedKeys.map(key => {
                const data = groupedData[key];
                const balance = data.income - data.expense;
                
                return `
                    <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4 mb-4">
                        <h4 class="font-semibold text-gray-800 dark:text-white mb-3">${key}</h4>
                        <div class="grid grid-cols-3 gap-4 mb-3">
                            <div class="text-center">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Pemasukan</p>
                                <p class="font-semibold text-green-600">${formatCurrency(data.income)}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Pengeluaran</p>
                                <p class="font-semibold text-red-600">${formatCurrency(data.expense)}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Saldo</p>
                                <p class="font-semibold ${balance >= 0 ? 'text-green-600' : 'text-red-600'}">${formatCurrency(balance)}</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">${data.transactions.length} transaksi</p>
                    </div>
                `;
            }).join('');
        }

        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
        }

        // Budget Functions
        function loadBudget() {
            if (!currentUser) return;
            
            const container = document.getElementById('budgetList');
            const budgets = currentUser.settings.budget || {};
            const budgetKeys = Object.keys(budgets);
            
            if (budgetKeys.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Belum ada budget yang ditetapkan</p>';
                return;
            }
            
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthlyExpenses = {};
            
            currentUser.transactions.filter(t => 
                t.tipe === 'pengeluaran' && t.tanggal.startsWith(currentMonth)
            ).forEach(t => {
                monthlyExpenses[t.kategori] = (monthlyExpenses[t.kategori] || 0) + t.nominal;
            });
            
            container.innerHTML = budgetKeys.map(category => {
                const budgetAmount = budgets[category];
                const spent = monthlyExpenses[category] || 0;
                const percentage = Math.min((spent / budgetAmount) * 100, 100);
                const isOverBudget = spent > budgetAmount;
                
                return `
                    <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-6 mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-semibold text-gray-800 dark:text-white">${category}</h4>
                            <button onclick="deleteBudget('${category}')" class="text-red-600 hover:text-red-800 dark:text-red-400">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-1">
                                <span>Terpakai: ${formatCurrency(spent)}</span>
                                <span>Budget: ${formatCurrency(budgetAmount)}</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                                <div class="progress-bar h-3 rounded-full ${isOverBudget ? 'bg-red-500' : percentage > 80 ? 'bg-yellow-500' : 'bg-green-500'}" 
                                     style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm ${isOverBudget ? 'text-red-600' : 'text-gray-600 dark:text-gray-400'}">
                                ${isOverBudget ? 'Melebihi budget' : `Sisa: ${formatCurrency(budgetAmount - spent)}`}
                            </span>
                            <span class="text-sm font-medium ${isOverBudget ? 'text-red-600' : 'text-gray-800 dark:text-white'}">
                                ${percentage.toFixed(1)}%
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addBudget(category, amount) {
            if (!currentUser.settings.budget) {
                currentUser.settings.budget = {};
            }
            
            currentUser.settings.budget[category] = parseInt(amount);
            saveData();
            loadBudget();
            showToast('Budget berhasil ditambahkan');
        }

        function deleteBudget(category) {
            if (confirm(`Yakin ingin menghapus budget untuk ${category}?`)) {
                delete currentUser.settings.budget[category];
                saveData();
                loadBudget();
                showToast('Budget berhasil dihapus');
            }
        }

        // Dark Mode
        function toggleDarkMode() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark);
            
            if (currentUser) {
                currentUser.settings.darkMode = isDark;
                saveData();
            }
            
            updateDarkModeIcon(isDark);
        }

        function applyDarkMode() {
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            const userDarkMode = currentUser?.settings?.darkMode || false;
            const isDark = savedDarkMode || userDarkMode;
            
            document.documentElement.classList.toggle('dark', isDark);
            updateDarkModeIcon(isDark);
        }

        function updateDarkModeIcon(isDark) {
            const icon = document.querySelector('#darkToggle i');
            icon.className = isDark ? 'fas fa-sun text-xl' : 'fas fa-moon text-xl';
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', async function() {
            // Hide loading screen after a delay
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 1000);
            
            // Load data from JSONBin
            await loadData();
            
            // Check for auto login
            if (!autoLogin()) {
                showAuth();
            }
            
            // Auth form handling
            const authForm = document.getElementById('authForm');
            authForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                if (isLogin) {
                    login(email, password);
                } else {
                    if (register(email, password)) {
                        login(email, password);
                    }
                }
            });
            
            // Auth switch button
            document.getElementById('authSwitch').addEventListener('click', function() {
                isLogin = !isLogin;
                
                if (isLogin) {
                    document.getElementById('authTitle').textContent = 'Masuk';
                    document.getElementById('authSubmit').textContent = 'Masuk';
                    document.getElementById('authSwitchText').textContent = 'Belum punya akun?';
                    document.getElementById('authSwitch').textContent = 'Daftar';
                } else {
                    document.getElementById('authTitle').textContent = 'Daftar';
                    document.getElementById('authSubmit').textContent = 'Daftar';
                    document.getElementById('authSwitchText').textContent = 'Sudah punya akun?';
                    document.getElementById('authSwitch').textContent = 'Masuk';
                }
            });
            
            // Close auth modal
            document.getElementById('closeAuth').addEventListener('click', function() {
                if (currentUser) {
                    hideAuth();
                }
            });
            
            // Navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });
            
            // User menu
            document.getElementById('userMenu').addEventListener('click', function() {
                document.getElementById('userDropdown').classList.toggle('hidden');
            });
            
            // Logout
            document.getElementById('logout').addEventListener('click', logout);
            
            // Dark mode toggle
            document.getElementById('darkToggle').addEventListener('click', toggleDarkMode);
            
            // Quick add form
            document.getElementById('quickAddForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const type = document.getElementById('quickType').value;
                const category = document.getElementById('quickCategory').value;
                const amount = document.getElementById('quickAmount').value;
                const description = document.getElementById('quickDescription').value;
                
                addTransaction(type, category, amount, description);
                
                // Reset form
                this.reset();
                updateQuickAddCategories();
            });
            
            // Quick type change
            document.getElementById('quickType').addEventListener('change', updateQuickAddCategories);
            
            // Transaction modal
            document.getElementById('addTransactionBtn').addEventListener('click', function() {
                editingTransaction = null;
                document.getElementById('transactionModalTitle').textContent = 'Tambah Transaksi';
                document.getElementById('transactionForm').reset();
                document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
                updateTransactionCategories();
                document.getElementById('transactionModal').classList.remove('hidden');
            });
            
            document.getElementById('closeTransactionModal').addEventListener('click', function() {
                document.getElementById('transactionModal').classList.add('hidden');
            });
            
            // Transaction form
            document.getElementById('transactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const type = document.getElementById('transactionType').value;
                const category = document.getElementById('transactionCategory').value;
                const amount = document.getElementById('transactionAmount').value;
                const description = document.getElementById('transactionDescription').value;
                const date = document.getElementById('transactionDate').value;
                
                if (editingTransaction) {
                    // Update existing transaction
                    editingTransaction.tipe = type;
                    editingTransaction.kategori = category;
                    editingTransaction.nominal = parseInt(amount);
                    editingTransaction.deskripsi = description;
                    editingTransaction.tanggal = date;
                    
                    saveData();
                    showToast('Transaksi berhasil diupdate');
                } else {
                    // Add new transaction
                    addTransaction(type, category, amount, description, date);
                }
                
                document.getElementById('transactionModal').classList.add('hidden');
                loadDashboard();
                displayTransactions();
            });
            
            // Transaction type change
            document.getElementById('transactionType').addEventListener('change', updateTransactionCategories);
            
            // Filter events
            document.getElementById('searchTransaction').addEventListener('input', displayTransactions);
            document.getElementById('filterType').addEventListener('change', displayTransactions);
            document.getElementById('filterCategory').addEventListener('change', displayTransactions);
            document.getElementById('filterDate').addEventListener('change', displayTransactions);
            
            // Period report buttons
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('.period-btn').forEach(b => {
                        b.classList.remove('bg-blue-600', 'text-white');
                        b.classList.add('bg-gray-200', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('bg-blue-600', 'text-white');
                    this.classList.remove('bg-gray-200', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
                    
                    // Load report for selected period
                    loadPeriodReport(this.dataset.period);
                });
            });
            
            // Budget modal
            document.getElementById('addBudgetBtn').addEventListener('click', function() {
                document.getElementById('budgetForm').reset();
                updateBudgetCategories();
                document.getElementById('budgetModal').classList.remove('hidden');
            });
            
            document.getElementById('closeBudgetModal').addEventListener('click', function() {
                document.getElementById('budgetModal').classList.add('hidden');
            });
            
            // Budget form
            document.getElementById('budgetForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const category = document.getElementById('budgetCategory').value;
                const amount = document.getElementById('budgetAmount').value;
                
                addBudget(category, amount);
                document.getElementById('budgetModal').classList.add('hidden');
            });
            
            function updateBudgetCategories() {
                const select = document.getElementById('budgetCategory');
                const categories = currentUser.categories.expense;
                
                select.innerHTML = categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
            }
            
            // Close modals when clicking outside
            document.addEventListener('click', function(e) {
                if (e.target.id === 'authModal') {
                    if (currentUser) {
                        hideAuth();
                    }
                }
                
                if (e.target.id === 'transactionModal') {
                    document.getElementById('transactionModal').classList.add('hidden');
                }
                
                if (e.target.id === 'budgetModal') {
                    document.getElementById('budgetModal').classList.add('hidden');
                }
                
                // Close user dropdown when clicking outside
                if (!e.target.closest('#userMenu') && !e.target.closest('#userDropdown')) {
                    document.getElementById('userDropdown').classList.add('hidden');
                }
            });
            
            // Initialize first tab
            switchTab('dashboard');
        });
        
        // Global functions for inline event handlers
        window.editTransaction = editTransaction;
        window.deleteTransaction = deleteTransaction;
        window.deleteBudget = deleteBudget;
    </script>
</body>
</html>